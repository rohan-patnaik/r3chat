# R3Chat - Product Requirements Document

## 1. Objective

To transform the `R3Chat` user interface into a more sophisticated, professional, and user-centric design. This involves restructuring the layout, enhancing key components, and implementing a new brown-based color theme for both light and dark modes across the main chat interface and the settings page. The goal is to provide a seamless, highly performant, and intuitive user experience for interacting with various large language models, with a focus on developer and data scientist workflows.

## 2. Product Vision & Goal

R3Chat is a fast, beautiful, and privacy-respecting AI chat web application. It aims to provide a seamless and highly performant user experience for interacting with various large language models, with a focus on developer and data scientist workflows.

## 3. Core Theme & Styling Guide

All existing blue accents should be replaced with the following brown-based color palette:

### 3.1. Dark Theme (Default)

*   **Background:** A very dark, desaturated brown. Hex: `#1c1a19`
*   **Component Background (e.g., Sidebar, Panels, Cards):** A slightly lighter dark brown. Hex: `#2a2726`
*   **Primary Accent:** A muted, warm, earthy brown for buttons, highlights, and selected items. Hex: `#8a6d5f`
*   **Text (Primary):** An off-white with a hint of cream. Hex: `#f0e9e4`
*   **Text (Secondary/Subtle):** A light gray-brown. Hex: `#a19a94`
*   **Borders/Dividers:** A subtle, darker brown. Hex: `#3a3633`
*   **Danger/Warning (for delete actions):** A deep, muted red/maroon. Hex: `#9e2a2b`

### 3.2. Light Theme

*   **Background:** A very light, creamy beige. Hex: `#f5f2ef`
*   **Component Background (e.g., Sidebar, Panels, Cards):** Pure white or a very light off-white. Hex: `#ffffff`
*   **Primary Accent:** A rich, medium-dark coffee brown. Hex: `#6b4f41`
*   **Text (Primary):** A very dark, almost black brown. Hex: `#3a3633`
*   **Text (Secondary/Subtle):** A grayish-brown. Hex: `#8d837c`
*   **Borders/Dividers:** A light, warm gray. Hex: `#dcd8d3`
*   **Danger/Warning (for delete actions):** A slightly lighter, muted red/maroon. Hex: `#c05758`

## 4. Key Features & Scope

### 4.1. General UI & Layout

*   **Responsive Design:** The layout should be optimized for desktop use.
*   **Dual Theme Support:** Dark and light brown themes.
*   **Spacing & Aesthetics:** Adjust spacing between all UI elements (text, headings, buttons, etc.) for a clean and beautiful layout. Ensure all elements fit well and are visually pleasing.
*   **Content Rendering:** All content rendering (markdown, code blocks, etc.) is visually polished.

### 4.2. Authentication

*   **Provider:** Google OAuth via Supabase Auth.
*   **Flow:**
    *   Unauthenticated users are redirected to a `/login` page.
    *   Successful login redirects users to the main chat interface.
    *   A logout button will be available to end the session.
*   **Security:** All data-access routes will be protected.

### 4.3. Conversation Management (CRUD)

*   **List Conversations:** Users can see a list of all their past conversations in a sidebar, grouped by date (Today, Yesterday, etc.). Section headers for these groupings (e.g., "Today", "Yesterday") should use a smaller, thinner font and be left-aligned as small headers.
*   **Create Conversation (Deferred Model):**
    *   Clicking "New Chat" will instantly present a clean slate for a new conversation without any delay.
    *   The conversation record is only created in the database *after* the user sends their first message and receives a response.
*   **Update Conversation:**
    *   The conversation title will be automatically generated by the LLM based on the first user message (4 words or less).
    *   Users will be able to manually rename conversations.
*   **Delete Conversation:** Users can delete conversations they no longer need.

### 4.4. Messaging & Freemium Model

*   **Send/Receive:** Users can send messages and receive responses from the selected AI model.
*   **Streaming:** AI responses are streamed token-by-token for a real-time feel.
*   **Model Selection:** Users can select from a list of available models. Non-freemium models are disabled for guest users.
*   **Credit System:** New users automatically receive 10 credits. Each message costs 1 credit. The UI displays the remaining credits in real-time.

## 5. Main Chat Interface (`ChatView`)

### 5.1. Main Layout

The two-column layout (Sidebar and Main Content) is retained. The sidebar should be collapsible and its width adjustable.

### 5.2. Sidebar (`ChatHistoryPanel`)

1.  **Header:**
    *   The "R3Chat" title should be center-aligned in the sidebar.
    *   A hamburger menu icon (`‚ò∞`) at the top-left of the page will serve as the sidebar toggle button, remaining in place whether the sidebar is open or closed. When clicked, it will change to a "Collapse Sidebar" icon (e.g., `[<-` or `->]`).
2.  **New Chat Button:**
    *   Styled as a pill-shaped button with the **Primary Accent** color as its background and **Primary Text** for its text. It should have slightly more rounded corners.
3.  **Search Bar:**
    *   Placeholder text: "Search your threads...".
    *   Styling: Use **Component Background** for the input field, **Secondary Text** for placeholder, and **Primary Text** for input.
4.  **Chat History List:**
    *   Each chat in the sidebar only shows a title (max 4 words), no subtitle, with reduced height.
    *   Add capability to display an icon to the left of a chat title (e.g., a code icon `</>` for programming chats), passed as a prop.
    *   Selected chat items should use the **Primary Accent** color for their background.
5.  **User Profile Section (Bottom):**
    *   User profile (avatar using Google ID image, name, plan badge "Pro" or "User") shown at the bottom center of the sidebar.
    *   All colors and fonts must conform to the new theme, using **Component Background** color for this section.
    *   Settings and sign out buttons in the sidebar should have tooltips on hover.

### 5.3. Main Content Area (`ChatView`) - Empty State

*   **Greeting:** Display a personalized, centered greeting: "How can I help you, [UserName]?". `[UserName]` should be dynamically inserted based on the logged-in user, using **Primary Text** color.
*   **Action Buttons:** Below the greeting, display a row of four pill-shaped, clickable buttons.
    *   Each button contains an icon and a label.
    *   Styled subtly: **Component Background** color and **Secondary Text** color for default state. Hover state uses **Primary Accent** background and **Primary Text** color.
    *   Buttons (use appropriate font icons):
        *   `‚ö° Create`
        *   `üó∫Ô∏è Explore`
        *   `</> Code`
        *   `üìö Learn`
*   **Suggested Prompts:** Below the action buttons, display 4-5 suggested prompts as plain text links.
    *   Examples: "How does AI work?", "Are black holes real?", "How many Rs are in the word \"strawberry\"?", "What is the meaning of life?".
    *   Clicking a prompt populates the chat input with that text. These links use the **Primary Accent** color for text and hover states.

### 5.4. Chat Input Area (`MessageInput`)

*   **Chatbox:** Make the chatbox taller and slightly translucent for background visibility.
*   **Model Selector:**
    *   Dropdown for model selection (e.g., "GPT-4o Mini", "Gemini 2.5 Flash").
    *   Restyled to match the new theme's muted aesthetic, using **Component Background** for dropdown body and **Primary Text** for selected value. Options use **Primary Text** with **Primary Accent** on hover/selection. Model name in dropdown is bold and matches sidebar button text size.
*   **Action Icons:** To the left of the text input area, place two distinct, subtle icons/buttons.
    *   Styled with **Secondary Text** color, and a clear hover state using **Primary Accent** color.
    *   **Search:** A magnifying glass icon (`üîç`). When active (e.g., web search enabled), its color might change to **Primary Accent**.
    *   **Attach:** A paperclip or file icon (`üìé` or `üìÅ`) for `.txt` and `.md` files, with tooltip on hover.
*   **Text Input Field:**
    *   Uses **Component Background** color, with **Primary Text** for input and **Secondary Text** for placeholder.
    *   Only shows a scrollbar if input is 2+ lines. The text should not be above the bottom part (model dropdown, attachment, send button) so it does not hinder visibility.
*   **Send Button:**
    *   Replaced with a square button with moderately rounded corners, filled with the **Primary Accent** color.
    *   Inside the square, an upward-pointing arrow icon (`‚Üë`) in **Primary Text** color.
    *   Send button is light blue (now brown theme) when enabled, greyed out when disabled.
*   **Alignment:** Model selector, attach, and send buttons are visually aligned and styled. Attach and send buttons are vertically stacked for a sleek look.

### 5.5. Top-Right Header Icons

*   Two icons placed at the top-right corner of the entire application window (outside the main chat area).
*   **Light/Dark Mode Toggle:** A sun (`‚òÄÔ∏è`) for light mode, moon (`üåô`) for dark mode. Uses **Primary Text** color, switches based on current theme. Has a subtle, translucent, contrasting shadow on hover (works for both themes).
*   **Settings Icon:** A gear (`‚öôÔ∏è`). Uses **Primary Text** color. Has a subtle, translucent, contrasting shadow on hover (works for both themes).

## 6. Settings Page

### 6.1. Global Settings Page Layout

1.  **Top Bar:**
    *   "Settings" title remains, with a "Back to Chat" arrow (`‚Üê`) to its left. Both in **Primary Text** color.
    *   The Light/Dark Mode toggle (`‚òÄÔ∏è`/`üåô`) and a "Sign out" text link are placed to the far right. Both in **Primary Text** color.
2.  **Main Content Area Structure:**
    *   Page has a `flex` or `grid` layout creating two main columns:
        *   **Left Column (Fixed Width):** Contains the User Profile, Plan Status, and Message Usage (persistent).
        *   **Right Column (Fluid Width):** Contains main settings content, organized by horizontal tabs.

### 6.2. Left Column (Persistent Panels)

This column combines user profile and usage information into distinct cards. Each card uses the **Component Background** color for its background, with subtle borders using **Borders/Dividers** color.

#### 6.2.1. User Profile Card

*   **Placement:** Top of the left column.
*   **Content:**
    *   Large circular avatar (matching user's initial or chosen avatar).
    *   User's `Display Name` (e.g., "Charles Mag") in **Primary Text** color.
    *   User's `Email Address` (e.g., `charlesmagey@gmail.com`) in **Secondary Text** color.
    *   Current `Plan` status (e.g., "Pro Plan") displayed as a styled tag, using **Primary Accent** background and **Primary Text** color.

#### 6.2.2. Message Usage Card

*   **Placement:** Directly below the User Profile Card in the left column.
*   **Content:**
    *   Header: "Message Usage" in **Primary Text** color.
    *   "Resets [Date]" indicating the reset date for credits/messages, in **Secondary Text** color.
    *   **Standard Usage:** Display "Standard" in **Primary Text** followed by a progress bar and "Current/Total" (e.g., "144/1500") in **Primary Text**.
        *   Progress bar: Uses **Primary Accent** for filled portion, **Borders/Dividers** for unfilled track.
        *   Below the bar, "X messages remaining" (e.g., "1356 messages remaining") in **Secondary Text** color.
    *   **Premium Usage:** Display "Premium" in **Primary Text** followed by an information icon (`‚ìò`) in **Secondary Text**. Progress bar and "Current/Total" (e.g., "98/100") in **Primary Text**.
        *   Progress bar: Uses **Primary Accent** for filled portion, **Borders/Dividers** for unfilled track.
        *   Below the bar, "X messages remaining" (e.g., "2 messages remaining") in **Secondary Text** color.
    *   **"Buy more premium credits" Button:** Prominent button at the bottom of the card.
        *   Background: **Primary Accent** color. Text: **Primary Text** color.
        *   Includes a right-arrow icon (`‚Üí`) in **Primary Text** color.

### 6.3. Right Column (Main Settings Content)

This area dynamically changes based on the selected horizontal tab.

#### 6.3.1. Horizontal Navigation Tabs

*   **Placement:** At the very top of the right column, below the global header.
*   **Tabs:** "Account", "Customization", "History & Sync", "Models", "API Keys", "Attachments", "Contact Us".
*   **Styling:** Each tab is a subtle, pill-shaped button.
    *   Default/Unselected: Text color **Secondary Text**, background **transparent** or subtle **Component Background**.
    *   Selected/Active: Text color **Primary Text**, background **Primary Accent** color.
    *   Hover: Slight increase in contrast or subtle background change (e.g., a slight tint of **Primary Accent**).

#### 6.3.2. Account Tab Content (`AccountSettingsPanel`)

*   **Header:** "Pro Plan Benefits" (if Pro, otherwise "Account Settings") in **Primary Text** color.
*   **Content (Pro Plan Benefits - if applicable):**
    *   Three visually distinct cards/boxes arranged horizontally.
    *   Each card: Prominent icon (e.g., `üöÄ`, `üí∞`, `üéß`) in **Primary Accent** or a slightly more vibrant shade. Title (e.g., "Access to All Models") in **Primary Text** color. Brief descriptive text in **Secondary Text** color.
    *   **Styling:** Each benefit card uses **Component Background** color and a subtle border in **Borders/Dividers** color.
*   **Content (Subscription Section):**
    *   Prominent "Manage Subscription" button. Background: **Primary Accent** color. Text: **Primary Text** color. Links to a placeholder credit card page.
*   **Content (Danger Zone):**
    *   Header: "Danger Zone" in **Primary Text** color.
    *   Warning text: "Permanently delete your account and all associated data." in **Secondary Text** color.
    *   **"Delete Account" Button:** Critical button for account deletion. Background: **Danger/Warning** color. Text: **Primary Text** color. Emphasize with a distinct hover/active state (e.g., slightly darker shade of danger color) to prevent accidental clicks.

#### 6.3.3. Models Tab Content (`ModelsPanel`)

*   **Header:** "Available Models" in **Primary Text** color.
*   **Description:** "Choose which models appear in your model selector. This won't affect existing conversations." in **Secondary Text** color.
*   **Action Buttons:** "Filter by features", "Select Recommended Models", "Unselect All".
    *   **Styling:** Use **Secondary Text** for text, subtle **Component Background** for background, with a distinct **Primary Accent** hover state (text color becoming **Primary Text**).
*   **Model List:**
    *   Each model in a distinct card/panel, using **Component Background** color and subtle border in **Borders/Dividers** color. Border when selected/active is **Primary Accent** color.
    *   **Card Content:**
        *   Model Icon (e.g., `‚ú®` for Gemini) in **Primary Accent** color.
        *   Model Name (e.g., "Gemini 2.0 Flash") in **Primary Text** color.
        *   Concise description in **Secondary Text** color.
        *   Key features as small, styled tags (e.g., `Vision`, `PDFs`). Tags use a darker tint of **Component Background** or subtle **Primary Accent** for background, and **Secondary Text** for text.
        *   Toggle switch (`Toggle`) to enable/disable the model. Uses **Primary Accent** color when enabled.
        *   "Show more" link in **Primary Accent** color.
        *   Optional "Search URL" link/icon (e.g., `üîó`) in **Primary Accent** color.

#### 6.3.4. API Keys Tab Content (`APIKeysPanel`)

*   **Header:** "API Keys" in **Primary Text** color.
*   **Description:** "Bring your own API keys for selected models. Messages sent using your API keys will not count towards your monthly limits." in **Secondary Text** color.
*   **API Key Sections:** For each API provider (e.g., Anthropic, OpenAI, Gemini):
    *   Provider name (e.g., "Anthropic API Key") in **Primary Text** color.
    *   List of models used (e.g., "Claude 3.5 Sonnet") as small tags in **Secondary Text** color with subtle **Component Background** background.
    *   Input field for the API Key (masked) in **Primary Text** color. Background slightly darker/lighter than card, borders in **Borders/Dividers** color.
    *   Link to "Get your API key from [Provider's] Console/Dashboard" in **Primary Accent** color.
    *   "Save" button with **Primary Accent** background and **Primary Text** color.
    *   **Styling:** Each section in its own card with **Component Background** color and subtle border in **Borders/Dividers** color.

## 7. Technical Stack

*   **Framework:** Next.js 15+ (App Router)
*   **Language:** TypeScript
*   **Styling:** Tailwind CSS v4, shadcn/ui
*   **Backend & Database:** Supabase (PostgreSQL, Realtime)
*   **Deployment:** Vercel

## 8. Out of Scope (for v1)

*   Team collaboration features
*   Actual payment processing for subscriptions.
*   Advanced admin dashboards (beyond profile management).

---

## 9. General UI Element Styling

*   **Text Inputs:** Backgrounds are slightly darker or lighter than the containing card background for subtle contrast. Borders are minimal and use the **Borders/Dividers** color. Text color is **Primary Text**, placeholder text **Secondary Text**.
*   **Buttons (General):** All buttons not specifically styled above adhere to the **Primary Accent** for background and **Primary Text** for text. Hover states provide a slight darkening (dark theme) or lightening (light theme) effect of the background, text remains **Primary Text**.
*   **Icons:** Use modern, minimalist icons. Their color is generally **Primary Text** or **Secondary Text**, with **Primary Accent** for interactive states or important elements.
*   **Borders:** All card borders and significant dividers use the **Borders/Dividers** color.
*   **Shadows:** Employ subtle, soft shadows if desired, kept minimal to maintain a clean aesthetic. Very dark, desaturated shadows for dark mode; very light, subtle shadows for light mode.
*   **Typography:** Maintain a consistent, modern sans-serif font family throughout the application for readability and a professional feel. Font sizes are carefully considered for hierarchy and legibility.
*   **Spacing and Layout:** Ensure consistent padding, margins, and spacing between elements to create a clean, organized, and uncrowded appearance. Use a modular grid system where appropriate.

---